!function(e,t){function l(e){e.toggleClass("open")}var n=function(e){var t,l=e.createElement("details");if(!("open"in l))return!1;var n=e.body||function(){var l=e.documentElement;return t=!0,l.insertBefore(e.createElement("body"),l.firstElementChild||l.firstChild)}();l.innerHTML="<summary>a</summary>b",l.style.display="block",n.appendChild(l);var o=l.offsetHeight;return l.open=!0,o=o!==l.offsetHeight,n.removeChild(l),t&&n.parentNode.removeChild(n),o}(e);t.fn.details=function(){return n?this:this.each(function(){var e=t(this),n=t("summary",e).first();n.prop("tabIndex",0),n.on("keydown",function(t){if(32===t.keyCode||13===t.keyCode)return l(e),!1}),n.on("click",function(){n.focus(),l(e)})})}}(document,jQuery),define("discourse/plugins/discourse-details/lib/discourse-markdown/details",["pretty-text/pretty-text","exports"],function(e,t){"use strict";function l(e,t,l){return"<details><summary>"+t+"</summary>"+l+"</details>"}function n(e){for(e=e||"";e!==(e=e.replace(/\[details=([^\]]+)\]((?:(?!\[details=[^\]]+\]|\[\/details\])[\S\s])*)\[\/details\]/gi,l)););return e.replace(/<\/summary>/gi,"</summary>\n\n").replace(/<\/details>/gi,"\n\n</details>\n\n")}function o(e){e.whiteList(["summary","summary[title]","details","details[open]","details.elided"]),e.addPreProcessor(function(e){return n(e)})}t.setup=o,(0,e.registerOption)(function(e,t){t.features.details=!0})}),define("discourse/plugins/discourse-details/initializers/apply-details",["discourse/lib/plugin-api","exports"],function(e,t){"use strict";function l(e){e.decorateCooked(function(e){return $("details",e).details()}),e.addToolbarPopupMenuOptionsCallback(function(){return{action:"insertDetails",icon:"caret-right",label:"details.title"}}),e.container.lookupFactory("controller:composer").reopen({actions:{insertDetails:function(){this.get("toolbarEvent").applySurround("[details="+I18n.t("composer.details_title")+"]","[/details]","details_text",{multiline:!1}),this.set("optionsVisible",!1)}}})}var n=e.withPluginApi;t.default={name:"apply-details",initialize:function(){n("0.5",l)}}}),define("discourse/plugins/discourse-slack-official/discourse/controllers/admin-plugins-slack",["discourse/plugins/discourse-slack-official/discourse/models/filter-rule","discourse/lib/ajax","discourse/lib/ajax-error","ember-addons/ember-computed-decorators","exports"],function(e,t,l,n,o){"use strict";var i=e.default,s=t.ajax,r=l.popupAjaxError,a=n.default;o.default=Ember.Controller.extend(function(e){for(var t={},l=0;l<e.length;l++){var n=e[l],o=n.decorators,i=n.key;if(delete n.key,delete n.decorators,n.enumerable=!0,n.configurable=!0,("value"in n||n.initializer)&&(n.writable=!0),o)for(var s=0;s<o.length;s++){var r=o[s];if("function"!=typeof r)throw new TypeError("The decorator for method "+n.key+" is of the invalid type "+typeof r);n=r(t,i,n)||n}n.initializer&&(n.value=n.initializer.call(t)),Object.defineProperty(t,i,n)}return t}([{key:"filters",initializer:function(){return[{id:"watch",name:I18n.t("slack.future.watch"),icon:"exclamation-circle"},{id:"follow",name:I18n.t("slack.future.follow"),icon:"circle"},{id:"mute",name:I18n.t("slack.future.mute"),icon:"times-circle"}]}},{key:"editing",initializer:function(){return i.create({})}},{key:"saveDisabled",decorators:[a("editing.channel")],value:function(e){return Ember.isEmpty(e)}},{key:"actions",initializer:function(){return{save:function(){var e=this,t=this.get("editing");s("/slack/list.json",{method:"PUT",data:t.getProperties("filter","category_id","channel","tags")}).then(function(){var l=e.get("model"),n=l.find(function(e){return e.get("category_id")===t.get("category_id")&&e.get("channel")===t.get("channel")&&e.get("tags")===t.get("tags")});n?n.setProperties({channel:t.channel,filter:t.filter,tags:t.tags}):l.pushObject(i.create(t.getProperties("filter","category_id","channel","tags")))}).catch(r)},delete:function(e){var t=this.get("model");s("/slack/list.json",{method:"DELETE",data:e.getProperties("filter","category_id","channel","tags")}).then(function(){var l=t.find(function(t){return t.get("category_id")===e.get("category_id")&&t.get("channel")===e.get("channel")&&t.get("tags")===e.get("tags")});t.removeObject(l)}).catch(r)},testNotification:function(){var e=this;this.set("testingNotification",!0),s("/slack/test.json",{method:"PUT"}).catch(r).finally(function(){e.set("testingNotification",!1)})},resetSettings:function(){s("/slack/reset_settings.json",{method:"PUT"}).catch(r)}}}}]))}),define("discourse/plugins/discourse-slack-official/discourse/routes/admin-plugins-slack",["discourse/plugins/discourse-slack-official/discourse/models/filter-rule","discourse/lib/ajax","exports"],function(e,t,l){"use strict";var n=e.default,o=t.ajax;l.default=Discourse.Route.extend({model:function(){return o("/slack/list.json").then(function(e){return e.slack.map(function(e){return n.create(e)})})}})}),define("discourse/plugins/discourse-slack-official/discourse/slack-route-map",["exports"],function(e){"use strict";e.default={resource:"admin.adminPlugins",path:"/plugins",map:function(){this.route("slack")}}}),Ember.TEMPLATES["javascripts/admin/plugins-slack"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["open-element","div",[]],["static-attr","id","admin-plugin-slack"],["flush-element"],["text","\\n  "],["open-element","h1",[]],["flush-element"],["append",["helper",["i18n"],["slack.header.rules"],null],false],["close-element"],["text","\\n\\n  "],["open-element","table",[]],["flush-element"],["text","\\n    "],["open-element","tr",[]],["flush-element"],["text","\\n      "],["open-element","th",[]],["flush-element"],["append",["helper",["i18n"],["slack.category"],null],false],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["siteSettings","tagging_enabled"]]],null,4],["text","\\n      "],["open-element","th",[]],["flush-element"],["append",["helper",["i18n"],["slack.channel"],null],false],["close-element"],["text","\\n      "],["open-element","th",[]],["flush-element"],["append",["helper",["i18n"],["slack.filter"],null],false],["close-element"],["text","\\n      "],["open-element","th",[]],["flush-element"],["close-element"],["text","\\n    "],["close-element"],["text","\\n\\n"],["block",["each"],[["get",["model"]]],null,3],["text","\\n    "],["open-element","tr",[]],["static-attr","class","new-filter"],["flush-element"],["text","\\n      "],["open-element","td",[]],["flush-element"],["text","\\n        "],["append",["helper",["category-chooser"],null,[["value","rootNoneLabel","rootNone"],[["get",["editing","category_id"]],"slack.choose.all_categories",true]]],false],["text","\\n      "],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["siteSettings","tagging_enabled"]]],null,1],["text","\\n      "],["open-element","td",[]],["flush-element"],["append",["helper",["text-field"],null,[["value","placeholderKey","class"],[["get",["editing","channel"]],"slack.choose.channel","channel"]]],false],["close-element"],["text","\\n      "],["open-element","td",[]],["flush-element"],["append",["helper",["combo-box"],null,[["content","value"],[["get",["filters"]],["get",["editing","filter"]]]]],false],["close-element"],["text","\\n\\n      "],["open-element","td",[]],["flush-element"],["text","\\n        "],["append",["helper",["d-button"],null,[["action","icon","class","title","disabled"],["save","save","save btn-primary","save",["get",["saveDisabled"]]]]],false],["text","\\n      "],["close-element"],["text","\\n    "],["close-element"],["text","\\n  "],["close-element"],["text","\\n\\n  "],["open-element","p",[]],["flush-element"],["append",["helper",["i18n"],["slack.command.help"],null],true],["close-element"],["text","\\n\\n  "],["append",["helper",["d-button"],null,[["action","icon","disabled","title","label"],["testNotification","rocket",["get",["testingNotification"]],"slack.test_notification","slack.test_notification"]]],false],["text","\\n\\n"],["block",["d-button"],null,[["action","icon","title","label"],["resetSettings","trash","slack.reset_settings","slack.reset_settings"]],0],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[],"locals":[]},{"statements":[["text","        "],["open-element","td",[]],["flush-element"],["append",["helper",["tag-chooser"],null,[["tags","placeholderKey"],[["get",["editing","tags"]],"slack.choose.tags"]]],false],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","          "],["open-element","td",[]],["flush-element"],["append",["unknown",["rule","tags"]],false],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","      "],["open-element","tr",[]],["static-attr","class",""],["flush-element"],["text","\\n        "],["open-element","td",[]],["flush-element"],["append",["unknown",["rule","categoryName"]],false],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["siteSettings","tagging_enabled"]]],null,2],["text","\\n        "],["open-element","td",[]],["flush-element"],["append",["unknown",["rule","channel"]],false],["close-element"],["text","\\n        "],["open-element","td",[]],["flush-element"],["append",["unknown",["rule","filterName"]],false],["close-element"],["text","\\n\\n        "],["open-element","td",[]],["flush-element"],["text","\\n"],["text","          "],["append",["helper",["d-button"],null,[["action","actionParam","icon","class","title"],["delete",["get",["rule"]],"trash-o","delete btn-danger","slack.delete"]]],false],["text","\\n        "],["close-element"],["text","\\n      "],["close-element"],["text","\\n"]],"locals":["rule"]},{"statements":[["text","        "],["open-element","th",[]],["flush-element"],["append",["helper",["i18n"],["slack.tags"],null],false],["close-element"],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/admin/plugins-slack"}}),define("discourse/plugins/discourse-slack-official/discourse/models/filter-rule",["discourse/models/rest","discourse/models/category","ember-addons/ember-computed-decorators","exports"],function(e,t,l,n){"use strict";var o=e.default,i=t.default,s=l.default;n.default=o.extend(function(e){for(var t={},l=0;l<e.length;l++){var n=e[l],o=n.decorators,i=n.key;if(delete n.key,delete n.decorators,n.enumerable=!0,n.configurable=!0,("value"in n||n.initializer)&&(n.writable=!0),o)for(var s=0;s<o.length;s++){var r=o[s];if("function"!=typeof r)throw new TypeError("The decorator for method "+n.key+" is of the invalid type "+typeof r);n=r(t,i,n)||n}n.initializer&&(n.value=n.initializer.call(t)),Object.defineProperty(t,i,n)}return t}([{key:"category_id",initializer:function(){return null}},{key:"channel",initializer:function(){return""}},{key:"filter",initializer:function(){return null}},{key:"categoryName",decorators:[s("category_id")],value:function(e){return e?i.findById(e).get("name"):I18n.t("slack.choose.all_categories")}},{key:"filterName",decorators:[s("filter")],value:function(e){return I18n.t("slack.present."+e)}}]))}),function(e){"use strict";function t(e,t){var l,n,o,i=e.data("width"),s=e.data("height"),r=e.data("ratio")?e.data("ratio"):t.default_ratio,a=e.data("youtube-id"),u=e.data("youtube-title"),c=[],p=e.data("parameters")||"";r=r.split(":"),"number"==typeof i&&"number"==typeof s?(e.width(i),l=s+"px"):"number"==typeof i?(e.width(i),l=i*r[1]/r[0]+"px"):(i=e.width(),0===i&&(i=e.parent().width()),l=r[1]/r[0]*100+"%"),c.push('<div class="ytp-thumbnail">'),c.push('<div class="ytp-large-play-button"'),i<=640&&c.push(' style="transform: scale(0.563888888888889);"'),c.push(">"),c.push("<svg>"),c.push('<path fill-rule="evenodd" clip-rule="evenodd" fill="#1F1F1F" class="ytp-large-play-button-svg" d="M84.15,26.4v6.35c0,2.833-0.15,5.967-0.45,9.4c-0.133,1.7-0.267,3.117-0.4,4.25l-0.15,0.95c-0.167,0.767-0.367,1.517-0.6,2.25c-0.667,2.367-1.533,4.083-2.6,5.15c-1.367,1.4-2.967,2.383-4.8,2.95c-0.633,0.2-1.316,0.333-2.05,0.4c-0.767,0.1-1.3,0.167-1.6,0.2c-4.9,0.367-11.283,0.617-19.15,0.75c-2.434,0.034-4.883,0.067-7.35,0.1h-2.95C38.417,59.117,34.5,59.067,30.3,59c-8.433-0.167-14.05-0.383-16.85-0.65c-0.067-0.033-0.667-0.117-1.8-0.25c-0.9-0.133-1.683-0.283-2.35-0.45c-2.066-0.533-3.783-1.5-5.15-2.9c-1.033-1.067-1.9-2.783-2.6-5.15C1.317,48.867,1.133,48.117,1,47.35L0.8,46.4c-0.133-1.133-0.267-2.55-0.4-4.25C0.133,38.717,0,35.583,0,32.75V26.4c0-2.833,0.133-5.95,0.4-9.35l0.4-4.25c0.167-0.966,0.417-2.05,0.75-3.25c0.7-2.333,1.567-4.033,2.6-5.1c1.367-1.434,2.967-2.434,4.8-3c0.633-0.167,1.333-0.3,2.1-0.4c0.4-0.066,0.917-0.133,1.55-0.2c4.9-0.333,11.283-0.567,19.15-0.7C35.65,0.05,39.083,0,42.05,0L45,0.05c2.467,0,4.933,0.034,7.4,0.1c7.833,0.133,14.2,0.367,19.1,0.7c0.3,0.033,0.833,0.1,1.6,0.2c0.733,0.1,1.417,0.233,2.05,0.4c1.833,0.566,3.434,1.566,4.8,3c1.066,1.066,1.933,2.767,2.6,5.1c0.367,1.2,0.617,2.284,0.75,3.25l0.4,4.25C84,20.45,84.15,23.567,84.15,26.4z M33.3,41.4L56,29.6L33.3,17.75V41.4z"></path>'),c.push('<polygon fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" points="33.3,41.4 33.3,17.75 56,29.6"></polygon>'),c.push("</svg>"),c.push("</div>"),c.push("</div>"),c.push('<div class="html5-info-bar">'),c.push('<div class="html5-title">'),c.push('<div class="html5-title-text-wrapper">'),c.push('<a class="html5-title-text" target="_blank" tabindex="3100" href="https://www.youtube.com/watch?v=',a,'">'),void 0===u||null===u||""===u?c.push("youtube.com/watch?v="+a):c.push(u),c.push("</a>"),c.push("</div>"),c.push("</div>"),c.push("</div>"),e.css({"padding-bottom":l}).html(c.join("")),o=i>640?"maxresdefault.jpg":i>480?"sddefault.jpg":i>320?"hqdefault.jpg":i>120?"mqdefault.jpg":0===i?"hqdefault.jpg":"default.jpg",n=e.find(".ytp-thumbnail").css({"background-image":["url(//img.youtube.com/vi/",a,"/",o,")"].join("")}).addClass("lazyYT-image-loaded").on("click",function(l){l.preventDefault(),!e.hasClass("lazyYT-video-loaded")&&n.hasClass("lazyYT-image-loaded")&&e.html('<iframe src="//www.youtube.com/embed/'+a+"?autoplay=1&"+p+'" frameborder="0" allowfullscreen></iframe>').addClass("lazyYT-video-loaded"),t.onPlay&&t.onPlay(l,e)})}e.fn.lazyYT=function(l){var n={default_ratio:"16:9",callback:null,container_class:"lazyYT-container"},o=e.extend(n,l);return this.each(function(){t(e(this).addClass(o.container_class),o)})}}(jQuery),function(e){e.fn.iframeTracker=function(t){var l=this.get();if(null===t||!1===t)e.iframeTracker.untrack(l);else{if("object"!=typeof t)throw new Error("Wrong handler type (must be an object, or null|false to untrack)");e.iframeTracker.track(l,t)}},e.iframeTracker={focusRetriever:null,focusRetrieved:!1,handlersList:[],isIE8AndOlder:!1,init:function(){try{1==e.browser.msie&&e.browser.version<9&&(this.isIE8AndOlder=!0)}catch(e){try{var t=navigator.userAgent.match(/(msie) ([\w.]+)/i);t[2]<9&&(this.isIE8AndOlder=!0)}catch(e){}}if(e(window).focus(),e(window).blur(function(t){e.iframeTracker.windowLoseFocus(t)}),e("body").append('<div style="position:fixed; top:0; left:0; overflow:hidden;"><input style="position:absolute; left:-300px;" type="text" value="" id="focus_retriever" readonly="true" /></div>'),this.focusRetriever=e("#focus_retriever"),this.focusRetrieved=!1,e(document).mousemove(function(t){document.activeElement&&"IFRAME"==document.activeElement.tagName&&(e.iframeTracker.focusRetriever.focus(),e.iframeTracker.focusRetrieved=!0)}),this.isIE8AndOlder){this.focusRetriever.blur(function(t){t.stopPropagation(),t.preventDefault(),e.iframeTracker.windowLoseFocus(t)}),e("body").click(function(t){e(window).focus()}),e("form").click(function(e){e.stopPropagation()});try{e("body").on("click","form",function(e){e.stopPropagation()})}catch(e){console.log("[iframeTracker] Please update jQuery to 1.7 or newer. (exception: "+e.message+")")}}},track:function(t,l){l.target=t,e.iframeTracker.handlersList.push(l),e(t).bind("mouseover",{handler:l},e.iframeTracker.mouseoverListener).bind("mouseout",{handler:l},e.iframeTracker.mouseoutListener)},untrack:function(t){if("function"!=typeof Array.prototype.filter)return void console.log("Your browser doesn't support Array filter, untrack disabled");e(t).each(function(t){e(this).unbind("mouseover",e.iframeTracker.mouseoverListener).unbind("mouseout",e.iframeTracker.mouseoutListener)});var l=function(e){return null!==e};for(var n in this.handlersList){for(var o in this.handlersList[n].target)-1!==e.inArray(this.handlersList[n].target[o],t)&&(this.handlersList[n].target[o]=null);this.handlersList[n].target=this.handlersList[n].target.filter(l),0==this.handlersList[n].target.length&&(this.handlersList[n]=null)}this.handlersList=this.handlersList.filter(l)},mouseoverListener:function(e){e.data.handler.over=!0;try{e.data.handler.overCallback(this)}catch(e){}},mouseoutListener:function(t){t.data.handler.over=!1,e.iframeTracker.focusRetriever.focus();try{t.data.handler.outCallback(this)}catch(e){}},windowLoseFocus:function(e){for(var t in this.handlersList)if(1==this.handlersList[t].over)try{this.handlersList[t].blurCallback()}catch(e){}}},e(document).ready(function(){e.iframeTracker.init()})}(jQuery),define("discourse/plugins/lazyYT/initializers/lazyYT",["discourse/lib/plugin-api","exports"],function(e,t){"use strict";var l=e.withPluginApi,n=function(){return!1};t.default={name:"apply-lazyYT",initialize:function(){l("0.1",function(e){e.decorateCooked(function(t){var l=$(".lazyYT",t);0!==l.length&&$(".lazyYT",t).lazyYT({onPlay:function(t,o){var i=parseInt(o.closest("article").data("post-id"));i&&e.preventCloak(i),$("iframe",l).iframeTracker({blurCallback:function(){$(document).on("scroll.discourse-youtube",n),window.setTimeout(function(){return $(document).off("scroll.discourse-youtube",n)},1500),$(document).scroll()}})}})})})}}}),define("discourse/plugins/poll/controllers/poll-ui-builder",["ember-addons/ember-computed-decorators","discourse/models/input-validation","exports"],function(e,t,l){"use strict";var n=e.default,o=e.observes,i=t.default;l.default=Ember.Controller.extend(function(e){for(var t={},l=0;l<e.length;l++){var n=e[l],o=n.decorators,i=n.key;if(delete n.key,delete n.decorators,n.enumerable=!0,n.configurable=!0,("value"in n||n.initializer)&&(n.writable=!0),o)for(var s=0;s<o.length;s++){var r=o[s];if("function"!=typeof r)throw new TypeError("The decorator for method "+n.key+" is of the invalid type "+typeof r);n=r(t,i,n)||n}n.initializer&&(n.value=n.initializer.call(t)),Object.defineProperty(t,i,n)}return t}([{key:"regularPollType",initializer:function(){return"regular"}},{key:"numberPollType",initializer:function(){return"number"}},{key:"multiplePollType",initializer:function(){return"multiple"}},{key:"init",value:function(){this._super(),this._setupPoll()}},{key:"pollTypes",decorators:[n("regularPollType","numberPollType","multiplePollType")],value:function(e,t,l){var n=[];return n.push({name:I18n.t("poll.ui_builder.poll_type.regular"),value:e}),n.push({name:I18n.t("poll.ui_builder.poll_type.number"),value:t}),n.push({name:I18n.t("poll.ui_builder.poll_type.multiple"),value:l}),n}},{key:"isRegular",decorators:[n("pollType","regularPollType")],value:function(e,t){return e===t}},{key:"isMultiple",decorators:[n("pollType","pollOptionsCount","multiplePollType")],value:function(e,t,l){return e===l&&t>0}},{key:"isNumber",decorators:[n("pollType","numberPollType")],value:function(e,t){return e===t}},{key:"showMinMax",decorators:[n("isRegular")],value:function(e){return!e}},{key:"pollOptionsCount",decorators:[n("pollOptions")],value:function(e){if(0===e.length)return 0;var t=0;return e.split("\n").forEach(function(e){0!==e.length&&(t+=1)}),t}},{key:"_setPollMax",decorators:[o("isMultiple","isNumber","pollOptionsCount")],value:function(){var e=this.get("isMultiple"),t=this.get("isNumber");(e||t)&&(e?this.set("pollMax",this.get("pollOptionsCount")):t&&this.set("pollMax",this.siteSettings.poll_maximum_options))}},{key:"pollMinOptions",decorators:[n("isRegular","isMultiple","isNumber","pollOptionsCount")],value:function(e,t,l,n){if(!e)return t?this._comboboxOptions(1,n+1):l?this._comboboxOptions(1,this.siteSettings.poll_maximum_options+1):void 0}},{key:"pollMaxOptions",decorators:[n("isRegular","isMultiple","isNumber","pollOptionsCount","pollMin","pollStep")],value:function(e,t,l,n,o,i){if(!e){var s=parseInt(o)||1;if(t)return this._comboboxOptions(s+1,n+1);if(l){var r=parseInt(i)||1;return this._comboboxOptions(s+1,s+this.siteSettings.poll_maximum_options*r)}}}},{key:"pollStepOptions",decorators:[n("isNumber","pollMax")],value:function(e,t){if(e)return this._comboboxOptions(1,(parseInt(t)||1)+1)}},{key:"pollOutput",decorators:[n("isNumber","showMinMax","pollType","publicPoll","pollOptions","pollMin","pollMax","pollStep")],value:function(e,t,l,n,o,i,s,r){var a="[poll",u="",c=this.get("toolbarEvent").getText().match(/\[poll(\s+name=[^\s\]]+)*.*\]/gim);return c&&(a+=" name=poll"+(c.length+1)),l&&(a+=" type="+l),i&&t&&(a+=" min="+i),s&&(a+=" max="+s),e&&(a+=" step="+r),n&&(a+=" public=true"),a+="]",u+=a+"\n",o.length>0&&!e&&o.split("\n").forEach(function(e){0!==e.length&&(u+="* "+e+"\n")}),u+="[/poll]"}},{key:"disableInsert",decorators:[n("pollOptionsCount","isRegular","isMultiple","isNumber","pollMin","pollMax")],value:function(e,t,l,n,o,i){return t&&e<2||l&&e<o&&o>=i||!n&&e<2}},{key:"minMaxValueValidation",decorators:[n("pollMin","pollMax")],value:function(e,t){var l={ok:!0};return e>=t&&(l={failed:!0,reason:I18n.t("poll.ui_builder.help.invalid_values")}),i.create(l)}},{key:"minNumOfOptionsValidation",decorators:[n("disableInsert")],value:function(e){var t={ok:!0};return e&&(t={failed:!0,reason:I18n.t("poll.ui_builder.help.options_count")}),i.create(t)}},{key:"_comboboxOptions",value:function(e,t){return _.range(e,t).map(function(e){return{value:e,name:e}})}},{key:"_setupPoll",value:function(){this.setProperties({pollType:null,publicPoll:!1,pollOptions:"",pollMin:1,pollMax:null,pollStep:1})}},{key:"actions",initializer:function(){return{insertPoll:function(){this.get("toolbarEvent").addText(this.get("pollOutput")),this.send("closeModal"),this._setupPoll()}}}}]))}),define("discourse/plugins/poll/lib/discourse-markdown/poll",["pretty-text/pretty-text","exports"],function(e,t){"use strict";function l(e){e.whiteList(["div.poll","div.poll-info","div.poll-container","div.poll-buttons","div[data-*]","span.info-number","span.info-text","a.button.cast-votes","a.button.toggle-results","li[data-*]"]),e.replaceBlock({start:/\[poll((?:\s+\w+=[^\s\]]+)*)\]([\s\S]*)/gim,stop:/\[\/poll\]/gim,emitter:function(t,l){var n=this,o=[];if(t.length)for(var i=function(e){if("string"==typeof e||e instanceof String){var t=n.processInline(String(e));t.length&&o.push(["p"].concat(t))}else o.push(e)},s=void 0;void 0!==(s=t.shift());)this.processBlock(s,t).forEach(i);var r={class:"poll"};r[v+"status"]="open",r[v+"name"]=b,(l[1].match(x)||[]).forEach(function(t){var l=t.split("="),n=m(l,2),o=n[0],i=n[1],s=e.escape(i.replace(/["']/g,""));r[v+o]=s});var a=parseInt(r[v+"min"],10),u=parseInt(r[v+"max"],10),c=parseInt(r[v+"step"],10);if("number"===r[v+"type"]){isNaN(a)&&(a=1),isNaN(u)&&(u=e.getOptions().pollMaximumOptions),isNaN(c)&&(c=1),o.push(["bulletlist"]);for(var p=a;p<=u;p+=c)o[0].push(["listitem",String(p)])}if(1!==o.length||o[0].length<=1||"numberlist"!==o[0][0]&&"bulletlist"!==o[0][0])return["div"].concat(o);for(var p=1;p<o[0].length;p++)if("listitem"!==o[0][p][0])return["div"].concat(o);for(var p=1;p<o[0].length;p++){var d={};d[v+"option-id"]=h(JSON.stringify(o[0][p].slice(1))),o[0][p].splice(1,0,d)}var f=["div",r],g=["div"],y=["div",{class:"poll-container"}].concat(o);g.push(y);var k=["div",{class:"poll-info"}];if(k.push(["p",["span",{class:"info-number"},"0"],["span",{class:"info-text"},I18n.t("poll.voters",{count:0})]]),"multiple"===r[v+"type"]){var _=o[0].length-1;(isNaN(a)||a<1)&&(a=1),(isNaN(u)||u>_)&&(u=_);var w=void 0;u>0&&(a===u?a>1&&(w=I18n.t("poll.multiple.help.x_options",{count:a})):a>1?w=u<_?I18n.t("poll.multiple.help.between_min_and_max_options",{min:a,max:u}):I18n.t("poll.multiple.help.at_least_min_options",{count:a}):u<=_&&(w=I18n.t("poll.multiple.help.up_to_max_options",{count:u}))),w&&k.push(["p",w])}"true"===r[v+"public"]&&k.push(["p",I18n.t("poll.public.title")]),g.push(k);var T=["div",{class:"poll-buttons"}];return"multiple"===r[v+"type"]&&T.push(["a",{class:"button cast-votes",title:I18n.t("poll.cast-votes.title")},I18n.t("poll.cast-votes.label")]),T.push(["a",{class:"button toggle-results",title:I18n.t("poll.show-results.title")},I18n.t("poll.show-results.label")]),f.push(g),f.push(T),f}})}function n(e,t){var l=e[0],n=e[1],o=e[2],u=e[3];l=i(l,n,o,u,t[0],7,-680876936),u=i(u,l,n,o,t[1],12,-389564586),o=i(o,u,l,n,t[2],17,606105819),n=i(n,o,u,l,t[3],22,-1044525330),l=i(l,n,o,u,t[4],7,-176418897),u=i(u,l,n,o,t[5],12,1200080426),o=i(o,u,l,n,t[6],17,-1473231341),n=i(n,o,u,l,t[7],22,-45705983),l=i(l,n,o,u,t[8],7,1770035416),u=i(u,l,n,o,t[9],12,-1958414417),o=i(o,u,l,n,t[10],17,-42063),n=i(n,o,u,l,t[11],22,-1990404162),l=i(l,n,o,u,t[12],7,1804603682),u=i(u,l,n,o,t[13],12,-40341101),o=i(o,u,l,n,t[14],17,-1502002290),n=i(n,o,u,l,t[15],22,1236535329),l=s(l,n,o,u,t[1],5,-165796510),u=s(u,l,n,o,t[6],9,-1069501632),o=s(o,u,l,n,t[11],14,643717713),n=s(n,o,u,l,t[0],20,-373897302),l=s(l,n,o,u,t[5],5,-701558691),u=s(u,l,n,o,t[10],9,38016083),o=s(o,u,l,n,t[15],14,-660478335),n=s(n,o,u,l,t[4],20,-405537848),l=s(l,n,o,u,t[9],5,568446438),u=s(u,l,n,o,t[14],9,-1019803690),o=s(o,u,l,n,t[3],14,-187363961),n=s(n,o,u,l,t[8],20,1163531501),l=s(l,n,o,u,t[13],5,-1444681467),u=s(u,l,n,o,t[2],9,-51403784),o=s(o,u,l,n,t[7],14,1735328473),n=s(n,o,u,l,t[12],20,-1926607734),l=r(l,n,o,u,t[5],4,-378558),u=r(u,l,n,o,t[8],11,-2022574463),o=r(o,u,l,n,t[11],16,1839030562),n=r(n,o,u,l,t[14],23,-35309556),l=r(l,n,o,u,t[1],4,-1530992060),u=r(u,l,n,o,t[4],11,1272893353),o=r(o,u,l,n,t[7],16,-155497632),n=r(n,o,u,l,t[10],23,-1094730640),l=r(l,n,o,u,t[13],4,681279174),u=r(u,l,n,o,t[0],11,-358537222),o=r(o,u,l,n,t[3],16,-722521979),n=r(n,o,u,l,t[6],23,76029189),l=r(l,n,o,u,t[9],4,-640364487),u=r(u,l,n,o,t[12],11,-421815835),o=r(o,u,l,n,t[15],16,530742520),n=r(n,o,u,l,t[2],23,-995338651),l=a(l,n,o,u,t[0],6,-198630844),u=a(u,l,n,o,t[7],10,1126891415),o=a(o,u,l,n,t[14],15,-1416354905),n=a(n,o,u,l,t[5],21,-57434055),l=a(l,n,o,u,t[12],6,1700485571),u=a(u,l,n,o,t[3],10,-1894986606),o=a(o,u,l,n,t[10],15,-1051523),n=a(n,o,u,l,t[1],21,-2054922799),l=a(l,n,o,u,t[8],6,1873313359),u=a(u,l,n,o,t[15],10,-30611744),o=a(o,u,l,n,t[6],15,-1560198380),n=a(n,o,u,l,t[13],21,1309151649),l=a(l,n,o,u,t[4],6,-145523070),u=a(u,l,n,o,t[11],10,-1120210379),o=a(o,u,l,n,t[2],15,718787259),n=a(n,o,u,l,t[9],21,-343485551),e[0]=f(l,e[0]),e[1]=f(n,e[1]),e[2]=f(o,e[2]),e[3]=f(u,e[3])}function o(e,t,l,n,o,i){return t=f(f(t,e),f(n,i)),f(t<<o|t>>>32-o,l)}function i(e,t,l,n,i,s,r){return o(t&l|~t&n,e,t,i,s,r)}function s(e,t,l,n,i,s,r){return o(t&n|l&~n,e,t,i,s,r)}function r(e,t,l,n,i,s,r){return o(t^l^n,e,t,i,s,r)}function a(e,t,l,n,i,s,r){return o(l^(t|~n),e,t,i,s,r)}function u(e){/[\x80-\xFF]/.test(e)&&(e=unescape(encodeURI(e)));var t,l=e.length,o=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)n(o,c(e.substring(t-64,t)));e=e.substring(t-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(n(o,i),t=0;t<16;t++)i[t]=0;return i[14]=8*l,n(o,i),o}function c(e){var t,l=[];for(t=0;t<64;t+=4)l[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return l}function p(e){for(var t="",l=0;l<4;l++)t+=k[e>>8*l+4&15]+k[e>>8*l&15];return t}function d(e){for(var t=0;t<e.length;t++)e[t]=p(e[t]);return e.join("")}function f(e,t){return e+t&4294967295}function h(e){return d(u(e))}var m=function(){function e(e,t){var l=[],n=!0,o=!1,i=void 0;try{for(var s,r=e[Symbol.iterator]();!(n=(s=r.next()).done)&&(l.push(s.value),!t||l.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(o)throw i}}return l}return function(t,l){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,l);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.setup=l;var g=e.registerOption,v="data-poll-",b="poll",y=["type","name","min","max","step","order","status","public"],x=new RegExp("("+y.join("|")+")=['\"]?[^\\s\\]]+['\"]?","g");g(function(e,t){var l=t.getCurrentUser&&t.getCurrentUser(t.userId)||t.currentUser,n=l&&l.staff;t.features.poll=!!e.poll_enabled||n,t.pollMaximumOptions=e.poll_maximum_options});var k="0123456789abcdef".split("")}),define("discourse/plugins/poll/lib/even-round",["exports"],function(e){"use strict";function t(e){return 100===e.map(function(e){return Math.floor(e)}).reduce(function(e,t){return e+t})}e.default=function(e){for(var l=e.map(function(e){return e%1}),n=Math.ceil(l.reduce(function(e,t){return e+t})),o=0,i=l.length;o<n&&o<i;o++){for(var s=0,r=0,a=0;a<l.length;a++)l[a]>s&&(r=a,s=l[a]);if(++e[r],l[r]=0,t(e))break}return e.map(function(e){return Math.floor(e)})}}),Ember.TEMPLATES["javascripts/modal/poll-ui-builder"]=Ember.HTMLBars.template({id:null,
block:'{"statements":[["block",["d-modal-body"],null,[["title","class"],["poll.ui_builder.title","poll-ui-builder"]],3],["text","\\n"],["open-element","div",[]],["static-attr","class","modal-footer"],["flush-element"],["text","\\n  "],["append",["helper",["d-button"],null,[["action","icon","class","label","disabled"],["insertPoll","bar-chart-o","btn-primary","poll.ui_builder.insert",["get",["disableInsert"]]]]],false],["text","\\n"],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","      "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n        "],["open-element","label",[]],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_options.label"],null],false],["close-element"],["text","\\n        "],["append",["helper",["input-tip"],null,[["validation"],[["get",["minNumOfOptionsValidation"]]]]],false],["text","\\n        "],["append",["helper",["textarea"],null,[["value"],[["get",["pollOptions"]]]]],false],["text","\\n      "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","        "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n          "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_config.step"],null],false],["close-element"],["text","\\n          "],["append",["helper",["input"],null,[["type","value","valueAttribute","class"],["number",["get",["pollStep"]],"value","poll-options-step"]]],false],["text","\\n        "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","      "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n        "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_config.min"],null],false],["close-element"],["text","\\n        "],["append",["helper",["input"],null,[["type","value","valueAttribute","class"],["number",["get",["pollMin"]],"value","poll-options-min"]]],false],["text","\\n        "],["append",["helper",["input-tip"],null,[["validation"],[["get",["minMaxValueValidation"]]]]],false],["text","\\n      "],["close-element"],["text","\\n\\n\\n      "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n        "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_config.max"],null],false],["close-element"],["text","\\n        "],["append",["helper",["input"],null,[["type","value","valueAttribute","class"],["number",["get",["pollMax"]],"value","poll-options-max"]]],false],["text","\\n      "],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["isNumber"]]],null,1]],"locals":[]},{"statements":[["text","  "],["open-element","form",[]],["static-attr","class","poll-ui-builder-form form-horizontal"],["flush-element"],["text","\\n    "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n      "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_type.label"],null],false],["close-element"],["text","\\n      "],["append",["helper",["combo-box"],null,[["content","value","valueAttribute"],[["get",["pollTypes"]],["get",["pollType"]],"value"]]],false],["text","\\n    "],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["showMinMax"]]],null,2],["text","\\n    "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n      "],["open-element","label",[]],["flush-element"],["text","\\n        "],["append",["helper",["input"],null,[["type","checked"],["checkbox",["get",["publicPoll"]]]]],false],["text","\\n        "],["append",["helper",["i18n"],["poll.ui_builder.poll_public.label"],null],false],["text","\\n      "],["close-element"],["text","\\n    "],["close-element"],["text","\\n\\n"],["block",["unless"],[["get",["isNumber"]]],null,0],["text","  "],["close-element"],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/modal/poll-ui-builder"}}),define("discourse/plugins/poll/initializers/add-poll-ui-builder",["discourse/lib/plugin-api","discourse/lib/show-modal","exports"],function(e,t,l){"use strict";function n(e){(e.container.lookup("site-settings:main").poll_enabled||!e.getCurrentUser()||e.getCurrentUser().staff)&&(e.container.lookupFactory("controller:composer").reopen({actions:{showPollBuilder:function(){i("poll-ui-builder").set("toolbarEvent",this.get("toolbarEvent"))}}}),e.addToolbarPopupMenuOptionsCallback(function(){return{action:"showPollBuilder",icon:"bar-chart-o",label:"poll.ui_builder.title"}}))}var o=e.withPluginApi,i=t.default;l.default={name:"add-poll-ui-builder",initialize:function(){o("0.5",n)}}}),define("discourse/plugins/poll/initializers/extend-for-poll",["discourse/lib/plugin-api","ember-addons/ember-computed-decorators","discourse-common/lib/get-owner","discourse/widgets/glue","exports"],function(e,t,l,n,o){"use strict";function i(e){for(var t={},l=0;l<e.length;l++){var n=e[l],o=n.decorators,i=n.key;if(delete n.key,delete n.decorators,n.enumerable=!0,n.configurable=!0,("value"in n||n.initializer)&&(n.writable=!0),o)for(var s=0;s<o.length;s++){var r=o[s];if("function"!=typeof r)throw new TypeError("The decorator for method "+n.key+" is of the invalid type "+typeof r);n=r(t,i,n)||n}n.initializer&&(n.value=n.initializer.call(t)),Object.defineProperty(t,i,n)}return t}function s(e){function t(t,l){var i=$(".poll",t);if(i.length){var s=l.getModel();e.preventCloak(s.id);var r=s.get("polls_votes")||{};s.pollsChanged();var a=s.get("pollsObject");a&&i.each(function(e,t){var l=$(t),i=l.data("poll-name"),u=a[i];if(u){var p="multiple"===u.get("type"),d=new c("discourse-poll",n,{id:i+"-"+s.id,post:s,poll:u,vote:r[i]||[],isMultiple:p});d.appendTo(t),o.push(d)}})}}function l(){o.forEach(function(e){return e.cleanUp()})}var n=u(e);e.container.lookupFactory("controller:topic").reopen({subscribe:function(){var e=this;this._super(),this.messageBus.subscribe("/polls/"+this.get("model.id"),function(t){var l=e.get("model.postStream").findLoadedPost(t.post_id);l&&l.set("polls",t.polls)})},unsubscribe:function(){this.messageBus.unsubscribe("/polls/*"),this._super()}}),e.container.lookupFactory("model:post").reopen(i([{key:"_polls",initializer:function(){return null}},{key:"pollsObject",initializer:function(){return null}},{key:"pollsChanged",decorators:[a("polls")],value:function(){var e=this,t=this.get("polls");t&&(this._polls=this._polls||{},_.map(t,function(t,l){e._polls[l]?e._polls[l].setProperties(t):e._polls[l]=Em.Object.create(t)}),this.set("pollsObject",this._polls),o.forEach(function(e){return e.queueRerender()}))}}]));var o=[];e.includePostAttributes("polls","polls_votes"),e.decorateCooked(t,{onlyStream:!0}),e.cleanupStream(l)}var r=e.withPluginApi,a=t.observes,u=l.getRegister,c=n.default;o.default={name:"extend-for-poll",initialize:function(){r("0.1",s)}}}),define("discourse/plugins/poll/widgets/discourse-poll",["discourse/widgets/widget","virtual-dom","discourse/helpers/fa-icon-node","discourse/widgets/raw-html","discourse/lib/ajax","discourse/plugins/poll/lib/even-round","discourse/widgets/post","discourse/lib/round","exports"],function(e,t,l,n,o,i,s,r,a){"use strict";function u(e){return new h({html:"<span>"+e.html+"</span>"})}function c(e){return m("/polls/voters.json",{type:"get",data:e}).catch(function(){bootbox.alert(I18n.t("poll.error_while_fetching_voters"))})}var p=e.createWidget,d=t.h,f=l.iconNode,h=n.default,m=o.ajax,g=i.default,v=s.avatarFor,b=r.default;p("discourse-poll-option",{tagName:"li",buildAttributes:function(e){return{"data-poll-option-id":e.option.id}},html:function(e){var t=[],l=e.option,n=e.vote,o=-1!==n.indexOf(l.id);return e.isMultiple?t.push(f(o?"check-square-o":"square-o")):t.push(f(o?"dot-circle-o":"circle-o")),t.push(" "),t.push(u(l)),t},click:function(e){0===$(e.target).closest("a").length&&this.sendWidgetAction("toggleOption",this.attrs.option)}}),p("discourse-poll-load-more",{tagName:"div.poll-voters-toggle-expand",buildKey:function(e){return e.id+"-load-more"},defaultState:function(){return{loading:!1}},html:function(e,t){return t.loading?d("div.spinner.small"):d("a",f("chevron-down"))},click:function(){var e=this.state;if(!e.loading)return e.loading=!0,this.sendWidgetAction("loadMore").finally(function(){return e.loading=!1})}}),p("discourse-poll-voters",{tagName:"ul.poll-voters-list",buildKey:function(e){return e.id()},defaultState:function(){return{loaded:"new",pollVoters:[],offset:1}},fetchVoters:function(){var e=this,t=this.attrs,l=this.state;if("loading"!==l.loaded)return l.loaded="loading",c({post_id:t.postId,poll_name:t.pollName,option_id:t.optionId,offset:l.offset}).then(function(n){l.loaded="loaded",l.offset+=1;var o=n[t.pollName],i="number"===t.pollType?o:o[t.optionId];l.pollVoters=l.pollVoters.concat(i),e.scheduleRerender()})},loadMore:function(){return this.fetchVoters()},html:function(e,t){e.pollVoters&&"new"===t.loaded&&(t.pollVoters=e.pollVoters);var l=t.pollVoters.map(function(e){return d("li",[v("tiny",{username:e.username,template:e.avatar_template})," "])});return t.pollVoters.length<e.totalVotes&&l.push(this.attach("discourse-poll-load-more",{id:e.id()})),d("div.poll-voters",l)}}),p("discourse-poll-standard-results",{tagName:"ul.results",buildKey:function(e){return e.id+"-standard-results"},defaultState:function(){return{loaded:"new"}},fetchVoters:function(){var e=this,t=this.attrs,l=this.state;"new"===l.loaded&&c({post_id:t.post.id,poll_name:t.poll.get("name")}).then(function(n){l.voters=n[t.poll.get("name")],l.loaded="loaded",e.scheduleRerender()})},html:function(e,t){var l=this,n=e.poll,o=n.get("options");if(o){var i=function(){var i=n.get("voters"),s=n.get("public"),r=_.clone(o).sort(function(e,t){return e.votes<t.votes?1:e.votes===t.votes?e.html<t.html?-1:1:-1}),a=0===i?Array(r.length).fill(0):r.map(function(e){return 100*e.votes/i}),c=e.isMultiple?a.map(Math.floor):g(a);return s&&l.fetchVoters(),{v:r.map(function(o,i){var r=[],a=c[i].toString(),p=(e.vote||[]).includes(o.id);return r.push(d("div.option",d("p",[d("span.percentage",a+"%"),u(o)]))),r.push(d("div.bar-back",d("div.bar",{attributes:{style:"width:"+a+"%"}}))),s&&r.push(l.attach("discourse-poll-voters",{id:function(){return"poll-voters-"+o.id},postId:e.post.id,optionId:o.id,pollName:n.get("name"),totalVotes:o.votes,pollVoters:t.voters&&t.voters[o.id]||[]})),d("li",{className:p?"chosen":""},r)})}}();if("object"==typeof i)return i.v}}}),p("discourse-poll-number-results",{buildKey:function(e){return e.id+"-number-results"},defaultState:function(){return{loaded:"new"}},fetchVoters:function(){var e=this,t=this.attrs,l=this.state;"new"===l.loaded&&c({post_id:t.post.id,poll_name:t.poll.get("name")}).then(function(n){l.voters=n[t.poll.get("name")],l.loaded="loaded",e.scheduleRerender()})},html:function(e,t){var l=e.poll,n=l.get("public"),o=l.get("options").reduce(function(e,t){return e+parseInt(t.html,10)*parseInt(t.votes,10)},0),i=l.voters,s=0===i?0:b(o/i,-2),r=I18n.t("poll.average_rating",{average:s}),a=[d("div.poll-results-number-rating",new h({html:"<span>"+r+"</span>"}))];return n&&(this.fetchVoters(),a.push(this.attach("discourse-poll-voters",{id:function(){return"poll-voters-"+l.get("name")},totalVotes:l.get("voters"),pollVoters:t.voters||[],postId:e.post.id,pollName:l.get("name"),pollType:l.get("type")}))),a}}),p("discourse-poll-container",{tagName:"div.poll-container",html:function(e){var t=this,l=e.poll;if(e.showResults){var n="number"===l.get("type")?"number":"standard";return this.attach("discourse-poll-"+n+"-results",e)}var o=l.get("options");if(o)return d("ul",o.map(function(l){return t.attach("discourse-poll-option",{option:l,isMultiple:e.isMultiple,vote:e.vote})}))}}),p("discourse-poll-info",{tagName:"div.poll-info",multipleHelpText:function(e,t,l){if(t>0)if(e===t){if(e>1)return I18n.t("poll.multiple.help.x_options",{count:e})}else{if(e>1)return t<l?I18n.t("poll.multiple.help.between_min_and_max_options",{min:e,max:t}):I18n.t("poll.multiple.help.at_least_min_options",{count:e});if(t<=l)return I18n.t("poll.multiple.help.up_to_max_options",{count:t})}},html:function(e){var t=e.poll,l=t.get("voters"),n=[d("p",[d("span.info-number",l.toString()),d("span.info-text",I18n.t("poll.voters",{count:l}))])];if(e.isMultiple)if(e.showResults){var o=t.get("options").reduce(function(e,t){return e+parseInt(t.votes,10)},0);n.push(d("p",[d("span.info-number",o.toString()),d("span.info-text",I18n.t("poll.total_votes",{count:o}))]))}else{var i=this.multipleHelpText(e.min,e.max,t.get("options.length"));i&&n.push(new h({html:"<span>"+i+"</span>"}))}return!e.showResults&&e.poll.get("public")&&n.push(d("p",I18n.t("poll.public.title"))),n}}),p("discourse-poll-buttons",{tagName:"div.poll-buttons",html:function(e){var t=[],l=e.poll,n=e.post,o=n.get("topic.archived"),i="closed"===l.get("status"),s=i||o;if(e.isMultiple&&!s){var r=!e.canCastVotes;t.push(this.attach("button",{className:"btn cast-votes "+(r?"":"btn-primary"),label:"poll.cast-votes.label",title:"poll.cast-votes.title",disabled:r,action:"castVotes"})),t.push(" ")}return e.showResults?t.push(this.attach("button",{className:"btn toggle-results",label:"poll.hide-results.label",title:"poll.hide-results.title",icon:"eye-slash",disabled:s,action:"toggleResults"})):t.push(this.attach("button",{className:"btn toggle-results",label:"poll.show-results.label",title:"poll.show-results.title",icon:"eye",disabled:0===l.get("voters"),action:"toggleResults"})),!this.currentUser||this.currentUser.get("id")!==n.get("user_id")&&!this.currentUser.get("staff")||o||(i?t.push(this.attach("button",{className:"btn toggle-status",label:"poll.open.label",title:"poll.open.title",icon:"unlock-alt",action:"toggleStatus"})):t.push(this.attach("button",{className:"btn toggle-status btn-danger",label:"poll.close.label",title:"poll.close.title",icon:"lock",action:"toggleStatus"}))),t}}),a.default=p("discourse-poll",{tagName:"div.poll",buildKey:function(e){return e.id},buildAttributes:function(e){var t=e.poll;return{"data-poll-type":t.get("type"),"data-poll-name":t.get("name"),"data-poll-status":t.get("status"),"data-poll-public":t.get("public")}},defaultState:function(e){var t=e.poll,l=e.post;return{loading:!1,showResults:t.get("isClosed")||l.get("topic.archived")}},html:function(e,t){var l=t.showResults,n=jQuery.extend({},e,{showResults:l,canCastVotes:this.canCastVotes(),min:this.min(),max:this.max()});return d("div",[this.attach("discourse-poll-container",n),this.attach("discourse-poll-info",n),this.attach("discourse-poll-buttons",n)])},isClosed:function(){return"closed"===this.attrs.poll.get("status")},min:function(){var e=parseInt(this.attrs.poll.min,10);return(isNaN(e)||e<1)&&(e=1),e},max:function(){var e=parseInt(this.attrs.poll.max,10),t=this.attrs.poll.options.length;return(isNaN(e)||e>t)&&(e=t),e},canCastVotes:function(){var e=this.state,t=this.attrs;if(this.isClosed()||e.showResults||e.loading)return!1;var l=t.vote.length;return t.isMultiple?l>=this.min()&&l<=this.max():l>0},toggleStatus:function(){var e=this,t=this.state,l=this.attrs,n=l.poll,o="closed"===n.get("status");bootbox.confirm(I18n.t(o?"poll.open.confirm":"poll.close.confirm"),I18n.t("no_value"),I18n.t("yes_value"),function(i){i&&function(){t.loading=!0;var i=o?"open":"closed";m("/polls/toggle_status",{type:"PUT",data:{post_id:l.post.get("id"),poll_name:n.get("name"),status:i}}).then(function(){n.set("status",i),e.scheduleRerender()}).catch(function(){bootbox.alert(I18n.t("poll.error_while_toggling_status"))}).finally(function(){t.loading=!1})}()})},toggleResults:function(){this.state.showResults=!this.state.showResults},showLogin:function(){this.register.lookup("route:application").send("showLogin")},toggleOption:function(e){if(!this.isClosed()){this.currentUser||this.showLogin();var t=this.attrs,l=t.vote,n=l.indexOf(e.id);return t.isMultiple||(l.length=0),-1!==n?l.splice(n,1):l.push(e.id),t.isMultiple?void 0:this.castVotes()}},castVotes:function(){if(this.canCastVotes()){if(!this.currentUser)return this.showLogin();var e=this.attrs,t=this.state;return t.loading=!0,m("/polls/vote",{type:"PUT",data:{post_id:e.post.id,poll_name:e.poll.name,options:e.vote}}).then(function(){t.showResults=!0}).catch(function(){bootbox.alert(I18n.t("poll.error_while_casting_votes"))}).finally(function(){t.loading=!1})}}})});
//# sourceMappingURL=/assets/plugin-8c8970cd6eb92dc6185edb35e54eca468f5cf5edc1921397154f1b225d77fbbe.js.map